<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>R√πa Valentine ¬∑ Space Edition</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            min-height: 100vh;
            background: radial-gradient(ellipse at 30% 40%, #4a1f3a, #0a0a1a);
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Poppins', 'Segoe UI', cursive, sans-serif;
            padding: 12px;
        }

        .game-wrapper {
            background: rgba(10, 5, 20, 0.6);
            backdrop-filter: blur(16px);
            border-radius: 80px;
            padding: 22px 22px 32px;
            box-shadow: 0 40px 70px rgba(0,0,0,0.8), inset 0 0 0 2px rgba(255, 180, 200, 0.5);
            border: 1px solid rgba(255, 200, 230, 0.4);
            max-width: 1000px;
            position: relative;
        }

        h1 {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            font-size: 2.8rem;
            color: #fff0fa;
            text-shadow: 0 0 25px #ff99cc, 0 0 50px #ff4d6d;
            margin-bottom: 8px;
            letter-spacing: 2px;
        }

        canvas {
            display: block;
            width: 100%;
            max-width: 900px;
            height: auto;
            border-radius: 60px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.9), 0 0 60px #ff99cc;
            background: transparent;
            cursor: pointer;
        }

        .stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 16px 8px 12px;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(12px);
            padding: 12px 24px;
            border-radius: 100px;
            border: 2px solid rgba(255, 200, 230, 0.8);
            box-shadow: 0 0 40px #ffb6c1;
        }

        .score-box {
            background: #1e0f2a;
            padding: 8px 36px;
            border-radius: 60px;
            font-size: 2.2rem;
            font-weight: 700;
            color: #ffe6f0;
            box-shadow: 0 0 25px #ff6f9e;
            border: 1px solid #ffb0c3;
        }

        .music-btn {
            background: #1e0f2a;
            border: none;
            padding: 8px 24px;
            border-radius: 50px;
            font-size: 1.6rem;
            font-weight: 600;
            color: #ffc0d5;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 0 25px #ff6f9e;
            cursor: pointer;
            border: 1px solid #ffb0c3;
            transition: 0.1s;
        }
        .music-btn:active { transform: scale(0.96); }

        .restart-btn {
            background: linear-gradient(145deg, #3a1f4a, #1a0f2a);
            border: none;
            font-size: 2rem;
            font-weight: bold;
            padding: 12px 48px;
            border-radius: 60px;
            color: #ffd9e6;
            border: 2px solid #ffb0c3;
            box-shadow: 0 0 40px #ff6f9e, 0 8px 0 #3a1f3a;
            cursor: pointer;
            transition: 0.06s linear;
            display: block;
            margin: 10px auto 5px;
        }
        .restart-btn:active {
            transform: translateY(8px);
            box-shadow: 0 0 40px #ff4d6d, 0 2px 0 #3a1f3a;
        }

        /* M√†n h√¨nh Start Game */
        .start-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at center, #1a0f2a, #050510);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            backdrop-filter: blur(10px);
        }
        .start-card {
            background: rgba(30, 10, 30, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 100px;
            padding: 50px 80px;
            text-align: center;
            border: 4px solid #ffb0c3;
            box-shadow: 0 0 100px #ff99cc;
        }
        .start-card h2 {
            font-size: 4rem;
            color: #ffe6f0;
            margin-bottom: 40px;
            text-shadow: 0 0 30px #ff99cc;
        }
        .start-btn {
            background: #ff4d6d;
            border: none;
            font-size: 3rem;
            font-weight: bold;
            padding: 20px 70px;
            border-radius: 90px;
            color: white;
            border: 4px solid white;
            box-shadow: 0 0 60px #ff99cc, 0 12px 0 #9e2f50;
            cursor: pointer;
            transition: 0.08s;
        }
        .start-btn:active {
            transform: translateY(12px);
            box-shadow: 0 0 60px #ff4d6d, 0 4px 0 #9e2f50;
        }

        /* Quiz screen */
        .quiz-screen {
            background: rgba(20, 5, 20, 0.9);
            backdrop-filter: blur(25px);
            border-radius: 80px;
            padding: 40px 50px;
            text-align: center;
            box-shadow: 0 0 90px #ff99cc, inset 0 0 0 4px rgba(255, 200, 220, 0.6);
            max-width: 800px;
            margin: 0 auto;
            border: 3px solid #ffb0c3;
        }
        .quiz-question {
            font-size: 2.8rem;
            color: #fff0f7;
            margin-bottom: 40px;
            font-weight: 700;
            text-shadow: 0 0 25px #ff99cc;
        }
        .quiz-options {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
            margin-bottom: 30px;
        }
        .quiz-option {
            background: rgba(80, 20, 40, 0.9);
            border: 3px solid #ff99cc;
            border-radius: 80px;
            padding: 18px 45px;
            font-size: 2.2rem;
            color: white;
            text-shadow: 0 0 15px #ffb6c1;
            cursor: pointer;
            box-shadow: 0 0 30px #ff4d6d, 0 8px 0 #4a1f3a;
            transition: 0.05s;
        }
        .quiz-option:active {
            transform: translateY(8px);
            box-shadow: 0 0 30px #ff99cc, 0 3px 0 #4a1f3a;
        }
        .feedback-message {
            font-size: 2.2rem;
            color: #ffd9e6;
            margin: 20px 0;
            background: rgba(0, 0, 0, 0.6);
            padding: 16px 30px;
            border-radius: 70px;
            border: 2px solid #ffb0c3;
        }
        .next-btn {
            background: #ff4d6d;
            border: none;
            font-size: 2rem;
            font-weight: bold;
            padding: 12px 48px;
            border-radius: 60px;
            color: white;
            border: 2px solid #ffb0c3;
            box-shadow: 0 0 30px #ff99cc, 0 8px 0 #9e2f50;
            cursor: pointer;
            margin: 10px auto 0;
        }
        .next-btn:active {
            transform: translateY(8px);
            box-shadow: 0 0 30px #ff4d6d, 0 2px 0 #9e2f50;
        }
        .valentine-card {
            background: linear-gradient(145deg, #ffc0d5, #ff99cc);
            border-radius: 70px;
            padding: 30px 40px;
            color: #4a1f3a;
            font-size: 2.3rem;
            line-height: 1.5;
            font-weight: 600;
            box-shadow: 0 0 90px #ff99cc;
            border: 6px solid white;
            margin-top: 20px;
            text-align: center;
        }
        .hidden { display: none !important; }

        audio { display: none; }
    </style>
</head>
<body>
    <!-- M√†n h√¨nh Start -->
    <div id="startOverlay" class="start-overlay">
        <div class="start-card">
            <h2>üê¢ R√ôA V≈® TR·ª§ üê¢</h2>
            <button class="start-btn" id="startGameBtn">B·∫ÆT ƒê·∫¶U</button>
        </div>
    </div>

    <div class="game-wrapper">
        <h1>
            <span>‚ú®</span> VALENTINE SPACE <span>‚ú®</span>
        </h1>

        <div id="gameArea">
            <canvas id="gameCanvas" width="900" height="500"></canvas>
            <div class="stats">
                <button class="music-btn" id="musicToggleBtn">üîä Nh·∫°c</button>
                <div class="score-box" id="scoreDisplay">0</div>
            </div>
            <button class="restart-btn" id="restartGameBtn">üí´ CH∆†I L·∫†I</button>
        </div>

        <div id="quizArea" class="quiz-screen hidden">
            <div id="quizQuestion" class="quiz-question"></div>
            <div class="quiz-options" id="quizOptions"></div>
            <div id="quizFeedback" class="feedback-message hidden"></div>
            <button id="nextQuestionBtn" class="next-btn hidden">üåπ TI·∫æP THEO</button>
            <div id="valentineCard" class="valentine-card hidden"></div>
        </div>
    </div>

    <audio id="bgMusic" loop>
        <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-14.mp3" type="audio/mpeg">
        <!-- Thay b·∫±ng link b√†i "M·∫∑t tr·ªùi c·ªßa em" n·∫øu c√≥ -->
    </audio>

    <script>
        (function() {
            // ========== C·∫§U H√åNH ==========
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            const scoreSpan = document.getElementById('scoreDisplay');
            const restartBtn = document.getElementById('restartGameBtn');
            const gameArea = document.getElementById('gameArea');
            const quizArea = document.getElementById('quizArea');
            const quizQuestion = document.getElementById('quizQuestion');
            const quizOptions = document.getElementById('quizOptions');
            const quizFeedback = document.getElementById('quizFeedback');
            const nextBtn = document.getElementById('nextQuestionBtn');
            const valentineCard = document.getElementById('valentineCard');
            const bgMusic = document.getElementById('bgMusic');
            const musicToggleBtn = document.getElementById('musicToggleBtn');

            // M√†n h√¨nh start
            const startOverlay = document.getElementById('startOverlay');
            const startBtn = document.getElementById('startGameBtn');

            // K√≠ch th∆∞·ªõc
            const W = 900, H = 500;
            const GROUND_Y = 430;
            const PLAYER_WIDTH = 65;
            const PLAYER_HEIGHT = 55;
            const PLAYER_X = 160;

            // Game state
            let gameActive = false;       // ban ƒë·∫ßu ch∆∞a ch·∫°y
            let score = 0;
            let player = {
                x: PLAYER_X,
                y: GROUND_Y - PLAYER_HEIGHT,
                vy: 0,
                grounded: true,
                scale: 1.0
            };
            const GRAVITY = 0.38;         // gi·∫£m nh·∫π ƒë·ªÉ d·ªÖ nh·∫£y
            const JUMP_POWER = -8.8;       // nh·∫£y th·∫•p h∆°n m·ªôt ch√∫t cho d·ªÖ

            // Obstacles
            let obstacles = [];
            const OBSTACLE_SPEED = 4.8;    // ch·∫≠m h∆°n m·ªôt ch√∫t
            const MIN_OBS_DIST = 320;
            const SPAWN_RATE = 45;          // spawn th∆∞a h∆°n
            let frameCounter = 0;

            // Jump control
            let jumpPressed = false;
            let canJump = true;

            // Nh·∫°c
            let musicPlaying = false;
            musicToggleBtn.addEventListener('click', () => {
                if (musicPlaying) {
                    bgMusic.pause();
                    musicToggleBtn.innerHTML = 'üîá Nh·∫°c';
                } else {
                    bgMusic.play().catch(e => {});
                    musicToggleBtn.innerHTML = 'üîä Nh·∫°c';
                }
                musicPlaying = !musicPlaying;
            });

            // Hi·ªáu ·ª©ng h·∫°t khi nh·∫£y
            let particles = [];
            class Particle {
                constructor(x, y) {
                    this.x = x; this.y = y;
                    this.vx = (Math.random() - 0.5) * 2.5;
                    this.vy = Math.random() * -1.5 - 0.5;
                    this.size = Math.random() * 5 + 2;
                    this.alpha = 0.7;
                    this.color = '#ffb6c1';
                }
                update() {
                    this.x += this.vx;
                    this.y += this.vy;
                    this.vy += 0.08;
                    this.alpha -= 0.01;
                    this.size *= 0.98;
                }
                draw() {
                    ctx.globalAlpha = this.alpha;
                    ctx.fillStyle = this.color;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, 2*Math.PI);
                    ctx.fill();
                    ctx.globalAlpha = 1;
                }
            }
            function addJumpParticles(x, y) {
                for (let i=0; i<8; i++) particles.push(new Particle(x + Math.random()*30-15, y+15));
            }

            // ========== V·∫º N·ªÄN SPACE R√ï N√âT ==========
            function drawBackground() {
                // Deep space gradient
                const grad = ctx.createLinearGradient(0, 0, 0, H);
                grad.addColorStop(0, '#0a0a1a');
                grad.addColorStop(0.8, '#2a1a2a');
                ctx.fillStyle = grad;
                ctx.fillRect(0, 0, W, H);

                // Sao l·ªõn l·∫•p l√°nh
                for (let i=0; i<200; i++) {
                    let x = (i*37) % W, y = (i*23) % H;
                    let brightness = 0.3 + 0.3 * Math.sin(Date.now()/600 + i);
                    ctx.fillStyle = `rgba(255, 240, 200, ${brightness})`;
                    ctx.beginPath();
                    ctx.arc(x, y, 1.2 + (i%3), 0, 2*Math.PI);
                    ctx.fill();
                }

                // Tinh v√¢n m·ªù
                ctx.globalAlpha = 0.15;
                ctx.fillStyle = '#b06f9f';
                ctx.beginPath();
                ctx.arc(200, 150, 200, 0, 2*Math.PI);
                ctx.fill();
                ctx.fillStyle = '#6fa0b0';
                ctx.beginPath();
                ctx.arc(700, 300, 180, 0, 2*Math.PI);
                ctx.fill();
                ctx.globalAlpha = 1;

                // H√†nh tinh l·ªõn
                ctx.shadowColor = '#ffb6c1';
                ctx.shadowBlur = 50;
                ctx.fillStyle = '#8a6f8a';
                ctx.beginPath();
                ctx.arc(200, GROUND_Y+50, 320, 0, Math.PI, true);
                ctx.fill();
                ctx.shadowBlur = 0;

                // M·∫∑t ƒë·∫•t
                ctx.fillStyle = '#5a4a6a';
                ctx.fillRect(0, GROUND_Y-6, W, H-GROUND_Y+6);
                ctx.fillStyle = '#7a6a8a';
                ctx.fillRect(0, GROUND_Y-3, W, 3);
            }

            // ========== V·∫º R√ôA SI√äU ƒê·∫∏P ==========
            function drawTurtle(x, y, scaleY = 1.0) {
                ctx.save();
                ctx.shadowColor = '#c0a0e0';
                ctx.shadowBlur = 30;

                // Mai ch√≠nh - h√¨nh b√°n c·∫ßu
                ctx.fillStyle = '#7caf5e';
                ctx.beginPath();
                ctx.ellipse(x + PLAYER_WIDTH/2, y + PLAYER_HEIGHT/2 - 4, PLAYER_WIDTH/2.2, (PLAYER_HEIGHT/2.5) * scaleY, 0, 0, 2*Math.PI);
                ctx.fill();

                // V√¢n mai (c√°c ƒë∆∞·ªùng tr√≤n ƒë·ªìng t√¢m)
                ctx.strokeStyle = '#4f7a2f';
                ctx.lineWidth = 2.5;
                for (let i=1; i<=3; i++) {
                    ctx.beginPath();
                    ctx.ellipse(x + PLAYER_WIDTH/2, y + PLAYER_HEIGHT/2 - 4, PLAYER_WIDTH/2.2 - i*6, (PLAYER_HEIGHT/2.5)*scaleY - i*4, 0, 0, 2*Math.PI);
                    ctx.stroke();
                }

                // ƒê·∫ßu
                ctx.fillStyle = '#9acd66';
                ctx.beginPath();
                ctx.ellipse(x + PLAYER_WIDTH - 12, y + PLAYER_HEIGHT/2 - 12, 14, 12, 0, 0, 2*Math.PI);
                ctx.fill();

                // M·∫Øt
                ctx.fillStyle = 'white';
                ctx.beginPath();
                ctx.arc(x + PLAYER_WIDTH - 4, y + PLAYER_HEIGHT/2 - 20, 5, 0, 2*Math.PI);
                ctx.fill();
                ctx.fillStyle = '#2b1a1a';
                ctx.beginPath();
                ctx.arc(x + PLAYER_WIDTH - 2, y + PLAYER_HEIGHT/2 - 22, 2.5, 0, 2*Math.PI);
                ctx.fill();
                ctx.fillStyle = 'white';
                ctx.beginPath();
                ctx.arc(x + PLAYER_WIDTH - 6, y + PLAYER_HEIGHT/2 - 24, 1, 0, 2*Math.PI);
                ctx.fill();

                // M·ªè
                ctx.fillStyle = '#d4a373';
                ctx.beginPath();
                ctx.arc(x + PLAYER_WIDTH - 1, y + PLAYER_HEIGHT/2 - 16, 2, 0, 2*Math.PI);
                ctx.fill();

                // Ch√¢n
                ctx.fillStyle = '#6b8e4c';
                ctx.beginPath();
                ctx.ellipse(x + 12, y + PLAYER_HEIGHT - 6, 10, 6, 0, 0, 2*Math.PI);
                ctx.fill();
                ctx.beginPath();
                ctx.ellipse(x + PLAYER_WIDTH - 24, y + PLAYER_HEIGHT - 6, 10, 6, 0, 0, 2*Math.PI);
                ctx.fill();

                // ƒêu√¥i
                ctx.fillStyle = '#557a3a';
                ctx.beginPath();
                ctx.moveTo(x + 4, y + PLAYER_HEIGHT/2 + 6);
                ctx.lineTo(x - 8, y + PLAYER_HEIGHT/2);
                ctx.lineTo(x - 8, y + PLAYER_HEIGHT/2 + 12);
                ctx.closePath();
                ctx.fill();

                ctx.restore();
            }

            // ========== V·∫º V·∫¨T C·∫¢N (d·ªÖ nh√¨n) ==========
            function drawObstacle(obs) {
                ctx.save();
                ctx.shadowBlur = 25;
                ctx.shadowColor = '#ff99cc';
                if (obs.type === 0) { // thi√™n th·∫°ch
                    ctx.fillStyle = '#a06a6a';
                    ctx.beginPath();
                    ctx.arc(obs.x + obs.width/2, obs.y + obs.height/2, obs.width/2, 0, 2*Math.PI);
                    ctx.fill();
                    ctx.fillStyle = '#6a4a4a';
                    ctx.beginPath();
                    ctx.arc(obs.x + 15, obs.y + 12, 8, 0, 2*Math.PI);
                    ctx.fill();
                } else if (obs.type === 1) { // bƒÉng
                    ctx.fillStyle = '#b0e0ff';
                    ctx.fillRect(obs.x, obs.y, obs.width, obs.height);
                } else if (obs.type === 2) { // ufo
                    ctx.fillStyle = '#b08a8a';
                    ctx.beginPath();
                    ctx.arc(obs.x + obs.width/2, obs.y + obs.height/2, obs.width/2, 0, 2*Math.PI);
                    ctx.fill();
                    ctx.fillStyle = '#f0d68a';
                    ctx.beginPath();
                    ctx.arc(obs.x + obs.width/2 - 6, obs.y + obs.height/2 - 8, 7, 0, 2*Math.PI);
                    ctx.fill();
                } else { // l·ªó ƒëen
                    ctx.fillStyle = '#2a1f2a';
                    ctx.beginPath();
                    ctx.arc(obs.x + obs.width/2, obs.y + obs.height/2, obs.width/2, 0, 2*Math.PI);
                    ctx.fill();
                }
                ctx.restore();
            }

            // ========== SINH V·∫¨T C·∫¢N ==========
            function spawnObstacle() {
                if (!gameActive) return;
                const type = Math.floor(Math.random() * 4);
                let w = 55 + Math.random()*20, h = 28 + Math.random()*18;
                obstacles.push({
                    x: W,
                    y: GROUND_Y - h - 5,
                    width: w, height: h,
                    type,
                    passed: false
                });
            }

            function rectCollide(x1,y1,w1,h1,x2,y2,w2,h2) {
                return x1 < x2 + w2 && x1 + w1 > x2 && y1 < y2 + h2 && y1 + h1 > y2;
            }

            // ========== C·∫¨P NH·∫¨T GAME ==========
            function updateGame() {
                if (!gameActive) return;

                // Tr·ªçng l·ª±c
                player.vy += GRAVITY;
                player.y += player.vy;

                if (player.y >= GROUND_Y - PLAYER_HEIGHT) {
                    player.y = GROUND_Y - PLAYER_HEIGHT;
                    player.vy = 0;
                    player.grounded = true;
                    player.scale = 1.0;
                } else {
                    player.grounded = false;
                    player.scale = (player.vy < 0) ? 1.08 : 0.95;
                }

                // Nh·∫£y
                if (jumpPressed && player.grounded && canJump) {
                    player.vy = JUMP_POWER;
                    player.grounded = false;
                    canJump = false;
                    addJumpParticles(player.x + PLAYER_WIDTH/2, player.y + PLAYER_HEIGHT-10);
                }
                if (!jumpPressed) canJump = true;

                // Di chuy·ªÉn obstacles
                for (let i = obstacles.length-1; i>=0; i--) {
                    let o = obstacles[i];
                    o.x -= OBSTACLE_SPEED;

                    if (!o.passed && o.x + o.width < PLAYER_X) {
                        o.passed = true;
                        score++;
                        scoreSpan.innerText = score;
                        if (score >= 27) {
                            gameActive = false;
                            startQuiz();
                            return;
                        }
                    }

                    if (o.x + o.width < 0) obstacles.splice(i,1);
                }

                // Va ch·∫°m
                for (let o of obstacles) {
                    if (rectCollide(player.x, player.y, PLAYER_WIDTH, PLAYER_HEIGHT, o.x, o.y, o.width, o.height)) {
                        gameActive = false;
                        alert('üí• R√πa l·∫°c v√†o v≈© tr·ª•! Th·ª≠ l·∫°i nh√©.');
                        resetGame();
                        return;
                    }
                }

                // Sinh v·∫≠t c·∫£n
                frameCounter++;
                if (frameCounter % SPAWN_RATE === 0 && (obstacles.length === 0 || obstacles[obstacles.length-1].x < W - MIN_OBS_DIST)) {
                    spawnObstacle();
                }

                // C·∫≠p nh·∫≠t h·∫°t
                for (let i=particles.length-1; i>=0; i--) {
                    particles[i].update();
                    if (particles[i].alpha <= 0) particles.splice(i,1);
                }
            }

            // ========== V·∫º ==========
            function draw() {
                drawBackground();
                obstacles.forEach(o => drawObstacle(o));
                drawTurtle(player.x, player.y, player.scale);
                particles.forEach(p => p.draw());

                ctx.font = 'bold 30px "Poppins", sans-serif';
                ctx.fillStyle = '#ffe6f0';
                ctx.shadowBlur = 30;
                ctx.shadowColor = '#ff99cc';
                ctx.fillText(`‚ú® ${score}/27`, 680, 70);
                ctx.shadowBlur = 0;
            }

            function gameLoop() {
                if (gameActive) updateGame();
                draw();
                requestAnimationFrame(gameLoop);
            }

            // ========== RESET GAME ==========
            function resetGame() {
                gameActive = true;   // sau khi start, game active
                score = 0;
                scoreSpan.innerText = '0';
                player.y = GROUND_Y - PLAYER_HEIGHT;
                player.vy = 0;
                obstacles = [];
                frameCounter = 0;
                particles = [];
                gameArea.classList.remove('hidden');
                quizArea.classList.add('hidden');
                // Kh√¥ng d·ª´ng nh·∫°c khi reset
            }

            // ========== B·∫ÆT ƒê·∫¶U GAME ==========
            startBtn.addEventListener('click', () => {
                startOverlay.classList.add('hidden');
                resetGame();  // gameActive = true
                // C√≥ th·ªÉ b·∫≠t nh·∫°c n·ªÅn nh·∫π n·∫øu mu·ªën
            });

            // ========== QUIZ ==========
            function startQuiz() {
                gameArea.classList.add('hidden');
                quizArea.classList.remove('hidden');
                currentQuestion = 0;
                showQuestion(0);
                nextBtn.classList.add('hidden');
                quizFeedback.classList.add('hidden');
                valentineCard.classList.add('hidden');
            }

            const questions = [
                {
                    q: "anh pin th√≠ch?",
                    options: [
                        { text: "apin th√≠ch em", feedback: "tuy·ªát v·ªùi l·∫Øm b·∫£o b·ªëi √†, em l√† s·ªë 1 c·ªßa l√≤ng anh" },
                        { text: "apin th√≠ch lego", feedback: "apin th√≠ch lego nh∆∞ng c·ª•c c∆∞ng c·ªßa a l√† em ƒë√≥ b·∫£o b·ªëi nh·ªè" }
                    ]
                },
                {
                    q: "apin v·ªÖ x∆∞∆°ng hong?",
                    options: [
                        { text: "v·ªÖ x∆∞n", feedback: "e tuy·ªát v·ªùi l·∫Øm, a bi·∫øt a e xun nh∆∞ e m√≤" },
                        { text: "siu v·ªÖ x∆∞n", feedback: "ƒë√∫ng v·∫≠y, 2 ch√∫ng ta l√† 1, siu c·∫•p v·ªÖ xun" }
                    ]
                },
                {
                    q: "apin y√™u e nh·ªè nhi·ªÅu hƒÉm?",
                    options: [
                        { text: "hƒÉm", feedback: "L·ªñI! Kh√¥ng ƒë∆∞·ª£c ch·ªçn 'hƒÉm', h√£y ch·ªçn 'siu siu siu nhi·ªÅu'", error: true },
                        { text: "siu siu siu nhi·ªÅu", feedback: "" }
                    ]
                }
            ];

            let currentQuestion = 0;

            function showQuestion(index) {
                if (index >= questions.length) {
                    quizQuestion.classList.add('hidden');
                    quizOptions.classList.add('hidden');
                    quizFeedback.classList.add('hidden');
                    nextBtn.classList.add('hidden');
                    valentineCard.classList.remove('hidden');
                    valentineCard.innerHTML = `e nh·ªè v·ªÖ xun, valentine n√†y a ·ªü xa m·∫•t r√πi n√™n kh√¥ng cho e nh·ªè nhi·ªÅu ƒë∆∞·ª£c, nma a v·∫´n y√™u em nhi·ªÅu, ch√∫c e nh·ªè c·ªßa apin ng√†y c√†ng v·ªÖ xun, y√™u em, anh y√™u em nhi·ªÅu ~~~ Moaaaaaaaaa~~~ Loveee üíñ`;

                    // T·ª± ƒë·ªông b·∫≠t nh·∫°c
                    bgMusic.play().then(() => {
                        bgMusic.loop = true;
                        musicPlaying = true;
                        musicToggleBtn.innerHTML = 'üîä Nh·∫°c';
                    }).catch(e => {});
                    return;
                }

                const q = questions[index];
                quizQuestion.innerText = q.q;
                quizQuestion.classList.remove('hidden');
                quizOptions.classList.remove('hidden');
                quizFeedback.classList.add('hidden');
                nextBtn.classList.add('hidden');
                valentineCard.classList.add('hidden');

                quizOptions.innerHTML = '';
                q.options.forEach((opt, i) => {
                    const btn = document.createElement('div');
                    btn.className = 'quiz-option';
                    btn.innerText = opt.text;
                    btn.addEventListener('click', () => handleAnswer(index, i));
                    quizOptions.appendChild(btn);
                });
            }

            function handleAnswer(qIndex, optIndex) {
                const q = questions[qIndex];
                const opt = q.options[optIndex];

                quizFeedback.innerText = opt.feedback || '‚ù§Ô∏è Y√™u th∆∞∆°ng...';
                quizFeedback.classList.remove('hidden');

                if (qIndex === 2 && optIndex === 0) {
                    nextBtn.classList.add('hidden');
                    return;
                }

                nextBtn.classList.remove('hidden');
            }

            nextBtn.addEventListener('click', () => {
                currentQuestion++;
                showQuestion(currentQuestion);
            });

            // ========== ƒêI·ªÄU KHI·ªÇN ==========
            window.addEventListener('keydown', (e) => {
                if (e.code === 'Space') { e.preventDefault(); jumpPressed = true; }
            });
            window.addEventListener('keyup', (e) => {
                if (e.code === 'Space') { e.preventDefault(); jumpPressed = false; }
            });
            canvas.addEventListener('click', () => {
                jumpPressed = true;
                setTimeout(() => jumpPressed = false, 100);
            });
            canvas.addEventListener('touchstart', (e) => {
                e.preventDefault();
                jumpPressed = true;
                setTimeout(() => jumpPressed = false, 100);
            });

            restartBtn.addEventListener('click', () => {
                if (gameActive) resetGame();
                else {
                    // N·∫øu game ch∆∞a active (hi·∫øm), v·∫´n reset ƒë∆∞·ª£c
                    resetGame();
                }
            });

            // Kh·ªüi ƒë·ªông game loop ngay, nh∆∞ng gameActive = false n√™n ch·ªâ v·∫Ω n·ªÅn tƒ©nh
            gameLoop();
        })();
    </script>
</body>
</html>